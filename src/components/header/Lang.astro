---
const locales = [
  { code: "es", label: "ES" },
  { code: "en", label: "EN" },
  { code: "it", label: "IT" },
];

const currentLocale = Astro.url.pathname.split("/")[1] || "";
---

<div class="relative inline-block text-sm">
  <select
    name="language"
    class="appearance-none bg-transparent border border-muted/30 rounded-lg px-4 py-2 pr-8 text-muted hover:text-foreground hover:border-accent transition-colors"
    onchange="window.location.href = this.value"
    aria-label="Language selector"
  >
    {
      locales.map((locale) => {
        const selected = locale.code === currentLocale;
        const targetPath = `/${locale.code}${Astro.url.pathname.replace(/^\/(es|en|it)/, "")}`;
        return (
          <option value={targetPath} selected={selected}>
            {locale.label}
          </option>
        );
      })
    }
  </select>
  <svg
    class="pointer-events-none absolute right-2 top-2.5 w-4 h-4 text-muted"
    fill="currentColor"
    viewBox="0 0 20 20"
  >
    <path
      fill-rule="evenodd"
      d="M5.23 7.21a.75.75 0 011.06.02L10 10.94l3.71-3.71a.75.75 0 111.06 1.06l-4.24 4.24a.75.75 0 01-1.06 0L5.21 8.29a.75.75 0 01.02-1.08z"
      clip-rule="evenodd"></path>
  </svg>
</div>
